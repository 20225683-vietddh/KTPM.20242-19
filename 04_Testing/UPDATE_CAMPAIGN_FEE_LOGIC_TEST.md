# ğŸ’° LOGIC Cáº¬P NHáº¬T Äá»¢T THU PHÃ - CAMPAIGN FEE UPDATE

## ğŸ“‹ Tá»•ng quan
Há»‡ thá»‘ng cáº­p nháº­t Ä‘á»£t thu phÃ­ vá»›i logic thÃ´ng minh, xá»­ lÃ½ cÃ¡c trÆ°á»ng há»£p phá»©c táº¡p vÃ  Ä‘áº£m báº£o tÃ­nh nháº¥t quÃ¡n cá»§a dá»¯ liá»‡u.

---

## ğŸ¯ CÃC TRÆ¯á»œNG Há»¢P Cáº¬P NHáº¬T

### ğŸ“… **TrÆ°á»ng há»£p 1: Cáº­p nháº­t thá»i gian (Start Date / End Date)**

#### Ká»‹ch báº£n 1.1: Gia háº¡n thá»i gian (Extend)
```
TrÆ°á»›c: 01/01/2024 - 31/01/2024
Sau:  01/01/2024 - 28/02/2024 (gia háº¡n thÃªm 1 thÃ¡ng)

âœ… LOGIC:
- Cho phÃ©p cáº­p nháº­t
- KhÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n dá»¯ liá»‡u thanh toÃ¡n hiá»‡n táº¡i
- ThÃ´ng bÃ¡o: "ÄÃ£ gia háº¡n Ä‘á»£t thu Ä‘áº¿n 28/02/2024"
```

#### Ká»‹ch báº£n 1.2: RÃºt ngáº¯n thá»i gian (Shorten)
```
TrÆ°á»›c: 01/01/2024 - 31/03/2024
Sau:  01/01/2024 - 31/01/2024 (rÃºt ngáº¯n 2 thÃ¡ng)

âš ï¸ Cáº¢NH BÃO:
- Kiá»ƒm tra cÃ³ thanh toÃ¡n nÃ o sau ngÃ y káº¿t thÃºc má»›i khÃ´ng
- Náº¿u cÃ³ â†’ Hiá»ƒn thá»‹ cáº£nh bÃ¡o + yÃªu cáº§u xÃ¡c nháº­n
- Náº¿u khÃ´ng â†’ Cho phÃ©p cáº­p nháº­t
```

#### Ká»‹ch báº£n 1.3: Thay Ä‘á»•i ngÃ y báº¯t Ä‘áº§u (Risky!)
```
TrÆ°á»›c: 01/01/2024 - 31/03/2024
Sau:  15/01/2024 - 31/03/2024 (dá»i ngÃ y báº¯t Ä‘áº§u)

ğŸš¨ NGUY HIá»‚M:
- CÃ³ thá»ƒ cÃ³ thanh toÃ¡n trÆ°á»›c ngÃ y báº¯t Ä‘áº§u má»›i
- Báº¯t buá»™c hiá»ƒn thá»‹ cáº£nh bÃ¡o nghiÃªm trá»ng
- YÃªu cáº§u xÃ¡c nháº­n 2 láº§n
```

### ğŸ’µ **TrÆ°á»ng há»£p 2: Cáº­p nháº­t sá»‘ tiá»n (Amount)**

#### Ká»‹ch báº£n 2.1: TÄƒng sá»‘ tiá»n
```
TrÆ°á»›c: 100,000 VND
Sau:  150,000 VND

âœ… LOGIC:
- Cho phÃ©p cáº­p nháº­t
- Cáº­p nháº­t táº¥t cáº£ báº£n ghi chÆ°a thanh toÃ¡n
- Giá»¯ nguyÃªn cÃ¡c báº£n ghi Ä‘Ã£ thanh toÃ¡n
- ThÃ´ng bÃ¡o: "ÄÃ£ cáº­p nháº­t phÃ­ cho X há»™ kháº©u chÆ°a thanh toÃ¡n"
```

#### Ká»‹ch báº£n 2.2: Giáº£m sá»‘ tiá»n
```
TrÆ°á»›c: 150,000 VND
Sau:  100,000 VND

âš ï¸ Cáº¢NH BÃO:
- Kiá»ƒm tra cÃ³ ai Ä‘Ã£ thanh toÃ¡n sá»‘ tiá»n cao hÆ¡n khÃ´ng
- Náº¿u cÃ³ â†’ Cáº£nh bÃ¡o + tÃ¹y chá»n hoÃ n tiá»n
- Cáº­p nháº­t cÃ¡c báº£n ghi chÆ°a thanh toÃ¡n
```

### ğŸ“ **TrÆ°á»ng há»£p 3: Cáº­p nháº­t mÃ´ táº£ (Description)**

#### Ká»‹ch báº£n 3.1: Thay Ä‘á»•i mÃ´ táº£
```
TrÆ°á»›c: "Thu phÃ­ quáº£n lÃ½ thÃ¡ng 1"
Sau:  "Thu phÃ­ quáº£n lÃ½ + báº£o trÃ¬ thang mÃ¡y thÃ¡ng 1"

âœ… LOGIC:
- LuÃ´n cho phÃ©p cáº­p nháº­t
- KhÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n dá»¯ liá»‡u thanh toÃ¡n
- Cáº­p nháº­t ngay láº­p tá»©c
```

### ğŸ  **TrÆ°á»ng há»£p 4: Thay Ä‘á»•i danh sÃ¡ch há»™ kháº©u Ã¡p dá»¥ng**

#### Ká»‹ch báº£n 4.1: ThÃªm há»™ kháº©u má»›i
```
TrÆ°á»›c: Ãp dá»¥ng cho 50 há»™ kháº©u
Sau:  Ãp dá»¥ng cho 55 há»™ kháº©u (thÃªm 5 há»™ má»›i)

âœ… LOGIC:
- Táº¡o báº£n ghi má»›i cho 5 há»™ kháº©u Ä‘Æ°á»£c thÃªm
- Tráº¡ng thÃ¡i: "ChÆ°a thanh toÃ¡n"
- ThÃ´ng bÃ¡o: "ÄÃ£ thÃªm 5 há»™ kháº©u vÃ o Ä‘á»£t thu"
```

#### Ká»‹ch báº£n 4.2: Loáº¡i bá» há»™ kháº©u
```
TrÆ°á»›c: Ãp dá»¥ng cho 50 há»™ kháº©u
Sau:  Ãp dá»¥ng cho 45 há»™ kháº©u (bá» 5 há»™)

âš ï¸ Cáº¢NH BÃO:
- Kiá»ƒm tra 5 há»™ bá»‹ loáº¡i bá» Ä‘Ã£ thanh toÃ¡n chÆ°a
- Náº¿u chÆ°a thanh toÃ¡n â†’ XÃ³a báº£n ghi
- Náº¿u Ä‘Ã£ thanh toÃ¡n â†’ Cáº£nh bÃ¡o + tÃ¹y chá»n hoÃ n tiá»n
```

### ğŸ’³ **TrÆ°á»ng há»£p 5: Thay Ä‘á»•i danh sÃ¡ch khoáº£n thu (FEE TYPES) - PHá»¨C Táº P NHáº¤T!**

#### Ká»‹ch báº£n 5.1: ThÃªm khoáº£n thu má»›i
```
TrÆ°á»›c: [PhÃ­ quáº£n lÃ½, PhÃ­ vá»‡ sinh, PhÃ­ báº£o vá»‡]
Sau:  [PhÃ­ quáº£n lÃ½, PhÃ­ vá»‡ sinh, PhÃ­ báº£o vá»‡, PhÃ­ thang mÃ¡y]

âœ… LOGIC:
- ThÃªm "PhÃ­ thang mÃ¡y" cho Táº¤T Cáº¢ há»™ kháº©u trong Ä‘á»£t thu
- Tráº¡ng thÃ¡i: "ChÆ°a thanh toÃ¡n" cho khoáº£n thu má»›i
- Giá»¯ nguyÃªn tráº¡ng thÃ¡i cÃ¡c khoáº£n thu cÅ©
- ThÃ´ng bÃ¡o: "ÄÃ£ thÃªm khoáº£n thu 'PhÃ­ thang mÃ¡y' cho táº¥t cáº£ há»™ kháº©u"
```

#### Ká»‹ch báº£n 5.2: XÃ³a khoáº£n thu (NGUY HIá»‚M!)
```
TrÆ°á»›c: [A, B, C, D]
Sau:  [A, B]
â†’ Khoáº£n thu C vÃ  D bá»‹ xÃ³a

ğŸš¨ LOGIC KIá»‚M TRA:
1. Kiá»ƒm tra cÃ³ há»™ nÃ o Ä‘Ã£ thanh toÃ¡n C hoáº·c D chÆ°a?
2. Náº¿u CÃ“ â†’ âŒ Tá»ª CHá»I cáº­p nháº­t
3. Náº¿u KHÃ”NG â†’ âœ… Cho phÃ©p xÃ³a
```

#### Ká»‹ch báº£n 5.3: Thay tháº¿ khoáº£n thu (Cá»°C Ká»² PHá»¨C Táº P!)
```
TrÆ°á»›c: [A, B, C, D]
Sau:  [A, B, E, F]
â†’ XÃ³a: [C, D], ThÃªm: [E, F]

ğŸ§  LOGIC THÃ”NG MINH:
1. PhÃ¢n tÃ­ch thay Ä‘á»•i:
   - Giá»¯ nguyÃªn: [A, B]
   - XÃ³a: [C, D] 
   - ThÃªm: [E, F]

2. Kiá»ƒm tra xung Ä‘á»™t:
   - CÃ³ há»™ nÃ o Ä‘Ã£ thanh toÃ¡n C? â†’ Náº¿u cÃ³: BLOCK
   - CÃ³ há»™ nÃ o Ä‘Ã£ thanh toÃ¡n D? â†’ Náº¿u cÃ³: BLOCK

3. Náº¿u khÃ´ng cÃ³ xung Ä‘á»™t:
   - XÃ³a táº¥t cáº£ báº£n ghi cá»§a C vÃ  D
   - ThÃªm báº£n ghi má»›i cho E vÃ  F (táº¥t cáº£ há»™ kháº©u)
   - Giá»¯ nguyÃªn A vÃ  B
```

#### Ká»‹ch báº£n 5.4: Thay Ä‘á»•i thÃ´ng tin khoáº£n thu
```
TrÆ°á»›c: PhÃ­ quáº£n lÃ½ - 100,000 VND
Sau:  PhÃ­ quáº£n lÃ½ - 120,000 VND

âš ï¸ LOGIC:
- Cáº­p nháº­t sá»‘ tiá»n cho cÃ¡c báº£n ghi CHÆ¯A thanh toÃ¡n
- Giá»¯ nguyÃªn sá»‘ tiá»n cho cÃ¡c báº£n ghi ÄÃƒ thanh toÃ¡n
- ThÃ´ng bÃ¡o: "ÄÃ£ cáº­p nháº­t phÃ­ cho X há»™ kháº©u chÆ°a thanh toÃ¡n"
```

---

## ğŸ”„ QUY TRÃŒNH Cáº¬P NHáº¬T CHI TIáº¾T

### BÆ°á»›c 1: Validation & Analysis
```java
// PhÃ¢n tÃ­ch thay Ä‘á»•i
CampaignFeeUpdateAnalysis analysis = analyzeCampaignFeeChanges(oldCampaign, newCampaign);

// Kiá»ƒm tra cÃ¡c Ä‘iá»u kiá»‡n
if (analysis.hasDateChanges()) {
    validateDateChanges(analysis);
}
if (analysis.hasAmountChanges()) {
    validateAmountChanges(analysis);
}
if (analysis.hasHouseholdChanges()) {
    validateHouseholdChanges(analysis);
}
```

### BÆ°á»›c 2: Warning & Confirmation
```java
// Táº¡o danh sÃ¡ch cáº£nh bÃ¡o
List<String> warnings = generateWarnings(analysis);

// Hiá»ƒn thá»‹ cáº£nh bÃ¡o náº¿u cáº§n
if (!warnings.isEmpty()) {
    boolean confirmed = showWarningDialog(warnings);
    if (!confirmed) return false;
}
```

### BÆ°á»›c 3: Execute Update
```java
// Cáº­p nháº­t theo tá»«ng loáº¡i thay Ä‘á»•i
if (analysis.hasDateChanges()) {
    updateCampaignDates(analysis);
}
if (analysis.hasAmountChanges()) {
    updateCampaignAmounts(analysis);
}
if (analysis.hasHouseholdChanges()) {
    updateCampaignHouseholds(analysis);
}
```

### BÆ°á»›c 4: Post-Update Actions
```java
// Cáº­p nháº­t thá»‘ng kÃª
updateCampaignStatistics(campaignId);

// Gá»­i thÃ´ng bÃ¡o
notifyAffectedHouseholds(analysis.getAffectedHouseholds());

// Log thay Ä‘á»•i
logCampaignChanges(analysis);
```

---

## ğŸ§ª TEST SCENARIOS

### Test Case 1: Gia háº¡n thá»i gian Ä‘Æ¡n giáº£n
```
INPUT:
- Old End Date: 31/01/2024
- New End Date: 29/02/2024
- KhÃ´ng cÃ³ thanh toÃ¡n nÃ o bá»‹ áº£nh hÆ°á»Ÿng

EXPECTED:
âœ… Cáº­p nháº­t thÃ nh cÃ´ng
âœ… KhÃ´ng cÃ³ cáº£nh bÃ¡o
âœ… ThÃ´ng bÃ¡o: "ÄÃ£ gia háº¡n Ä‘á»£t thu Ä‘áº¿n 29/02/2024"
```

### Test Case 2: RÃºt ngáº¯n thá»i gian cÃ³ xung Ä‘á»™t
```
INPUT:
- Old End Date: 31/03/2024
- New End Date: 31/01/2024
- CÃ³ 5 thanh toÃ¡n trong thÃ¡ng 2-3

EXPECTED:
âš ï¸ Hiá»ƒn thá»‹ cáº£nh bÃ¡o: "5 há»™ kháº©u Ä‘Ã£ thanh toÃ¡n sau ngÃ y káº¿t thÃºc má»›i"
âš ï¸ YÃªu cáº§u xÃ¡c nháº­n
âœ… Náº¿u xÃ¡c nháº­n â†’ Cáº­p nháº­t + giá»¯ nguyÃªn thanh toÃ¡n
```

### Test Case 3: TÄƒng sá»‘ tiá»n
```
INPUT:
- Old Amount: 100,000 VND
- New Amount: 150,000 VND
- 30 há»™ chÆ°a thanh toÃ¡n, 20 há»™ Ä‘Ã£ thanh toÃ¡n

EXPECTED:
âœ… Cáº­p nháº­t 30 há»™ chÆ°a thanh toÃ¡n â†’ 150,000 VND
âœ… Giá»¯ nguyÃªn 20 há»™ Ä‘Ã£ thanh toÃ¡n â†’ 100,000 VND
âœ… ThÃ´ng bÃ¡o: "ÄÃ£ cáº­p nháº­t phÃ­ cho 30 há»™ kháº©u chÆ°a thanh toÃ¡n"
```

### Test Case 4: Giáº£m sá»‘ tiá»n cÃ³ xung Ä‘á»™t
```
INPUT:
- Old Amount: 150,000 VND
- New Amount: 100,000 VND
- 10 há»™ Ä‘Ã£ thanh toÃ¡n 150,000 VND

EXPECTED:
âš ï¸ Cáº£nh bÃ¡o: "10 há»™ kháº©u Ä‘Ã£ thanh toÃ¡n sá»‘ tiá»n cao hÆ¡n"
âš ï¸ TÃ¹y chá»n: "HoÃ n tiá»n 50,000 VND cho má»—i há»™?"
âœ… Cáº­p nháº­t cÃ¡c há»™ chÆ°a thanh toÃ¡n
```

### Test Case 5: ThÃªm há»™ kháº©u má»›i
```
INPUT:
- ThÃªm 5 há»™ kháº©u má»›i vÃ o Ä‘á»£t thu Ä‘ang diá»…n ra
- Campaign Amount: 100,000 VND

EXPECTED:
âœ… Táº¡o 5 báº£n ghi má»›i vá»›i tráº¡ng thÃ¡i "ChÆ°a thanh toÃ¡n"
âœ… Amount: 100,000 VND cho má»—i há»™
âœ… ThÃ´ng bÃ¡o: "ÄÃ£ thÃªm 5 há»™ kháº©u vÃ o Ä‘á»£t thu"
```

### Test Case 6: Loáº¡i bá» há»™ kháº©u Ä‘Ã£ thanh toÃ¡n
```
INPUT:
- Loáº¡i bá» 3 há»™ kháº©u khá»i Ä‘á»£t thu
- 2 há»™ Ä‘Ã£ thanh toÃ¡n, 1 há»™ chÆ°a thanh toÃ¡n

EXPECTED:
âš ï¸ Cáº£nh bÃ¡o: "2 há»™ kháº©u Ä‘Ã£ thanh toÃ¡n sáº½ bá»‹ loáº¡i bá»"
âš ï¸ TÃ¹y chá»n: "HoÃ n tiá»n cho 2 há»™ kháº©u nÃ y?"
âœ… XÃ³a 1 báº£n ghi chÆ°a thanh toÃ¡n
âœ… Giá»¯ hoáº·c xÃ³a 2 báº£n ghi Ä‘Ã£ thanh toÃ¡n (tÃ¹y lá»±a chá»n)
```

### Test Case 7: ThÃªm khoáº£n thu má»›i
```
INPUT:
- ThÃªm "PhÃ­ thang mÃ¡y" cho táº¥t cáº£ há»™ kháº©u trong Ä‘á»£t thu
- Campaign Amount: 100,000 VND

EXPECTED:
âœ… Táº¡o 5 báº£n ghi má»›i vá»›i tráº¡ng thÃ¡i "ChÆ°a thanh toÃ¡n"
âœ… Amount: 100,000 VND cho má»—i há»™
âœ… ThÃ´ng bÃ¡o: "ÄÃ£ thÃªm khoáº£n thu 'PhÃ­ thang mÃ¡y' cho táº¥t cáº£ há»™ kháº©u"
```

### Test Case 8: XÃ³a khoáº£n thu cÃ³ xung Ä‘á»™t
```
INPUT:
- XÃ³a "PhÃ­ thang mÃ¡y" khá»i Ä‘á»£t thu
- 5 há»™ kháº©u Ä‘Ã£ thanh toÃ¡n "PhÃ­ thang mÃ¡y"

EXPECTED:
âŒ Tá»ª CHá»I cáº­p nháº­t
âŒ ThÃ´ng bÃ¡o lá»—i: "KhÃ´ng thá»ƒ xÃ³a 'PhÃ­ thang mÃ¡y' vÃ¬ Ä‘Ã£ cÃ³ 5 há»™ kháº©u thanh toÃ¡n!"
âŒ Gá»£i Ã½: "Vui lÃ²ng hoÃ n tiá»n trÆ°á»›c khi xÃ³a khoáº£n thu nÃ y"
```

### Test Case 9: XÃ³a khoáº£n thu an toÃ n
```
INPUT:
- XÃ³a "PhÃ­ thang mÃ¡y" khá»i Ä‘á»£t thu
- 0 há»™ kháº©u Ä‘Ã£ thanh toÃ¡n "PhÃ­ thang mÃ¡y"

EXPECTED:
âœ… XÃ³a thÃ nh cÃ´ng táº¥t cáº£ báº£n ghi "PhÃ­ thang mÃ¡y"
âœ… ThÃ´ng bÃ¡o: "ÄÃ£ xÃ³a khoáº£n thu 'PhÃ­ thang mÃ¡y' khá»i Ä‘á»£t thu"
```

### Test Case 10: Thay tháº¿ khoáº£n thu phá»©c táº¡p
```
INPUT:
- TrÆ°á»›c: [PhÃ­ quáº£n lÃ½, PhÃ­ vá»‡ sinh, PhÃ­ báº£o vá»‡, PhÃ­ thang mÃ¡y]
- Sau:  [PhÃ­ quáº£n lÃ½, PhÃ­ vá»‡ sinh, PhÃ­ Ä‘iá»‡n, PhÃ­ nÆ°á»›c]
- XÃ³a: [PhÃ­ báº£o vá»‡, PhÃ­ thang mÃ¡y]
- ThÃªm: [PhÃ­ Ä‘iá»‡n, PhÃ­ nÆ°á»›c]
- CÃ³ 3 há»™ Ä‘Ã£ thanh toÃ¡n "PhÃ­ báº£o vá»‡"

EXPECTED:
âŒ Tá»ª CHá»I cáº­p nháº­t
âŒ ThÃ´ng bÃ¡o: "KhÃ´ng thá»ƒ xÃ³a 'PhÃ­ báº£o vá»‡' vÃ¬ Ä‘Ã£ cÃ³ 3 há»™ kháº©u thanh toÃ¡n!"
âŒ Danh sÃ¡ch khoáº£n thu khÃ´ng thay Ä‘á»•i
```

### Test Case 11: Thay tháº¿ khoáº£n thu thÃ nh cÃ´ng
```
INPUT:
- TrÆ°á»›c: [PhÃ­ quáº£n lÃ½, PhÃ­ vá»‡ sinh, PhÃ­ báº£o vá»‡, PhÃ­ thang mÃ¡y]
- Sau:  [PhÃ­ quáº£n lÃ½, PhÃ­ vá»‡ sinh, PhÃ­ Ä‘iá»‡n, PhÃ­ nÆ°á»›c]
- XÃ³a: [PhÃ­ báº£o vá»‡, PhÃ­ thang mÃ¡y] (0 há»™ Ä‘Ã£ thanh toÃ¡n)
- ThÃªm: [PhÃ­ Ä‘iá»‡n, PhÃ­ nÆ°á»›c]

EXPECTED:
âœ… XÃ³a táº¥t cáº£ báº£n ghi "PhÃ­ báº£o vá»‡" vÃ  "PhÃ­ thang mÃ¡y"
âœ… Táº¡o báº£n ghi má»›i "PhÃ­ Ä‘iá»‡n" vÃ  "PhÃ­ nÆ°á»›c" cho táº¥t cáº£ há»™ kháº©u
âœ… Giá»¯ nguyÃªn "PhÃ­ quáº£n lÃ½" vÃ  "PhÃ­ vá»‡ sinh"
âœ… ThÃ´ng bÃ¡o: "ÄÃ£ cáº­p nháº­t danh sÃ¡ch khoáº£n thu thÃ nh cÃ´ng"
```

---

## ğŸ”§ IMPLEMENTATION DETAILS

### ğŸ†• Classes cáº§n táº¡o
```java
// PhÃ¢n tÃ­ch thay Ä‘á»•i
public class CampaignFeeUpdateAnalysis {
    private boolean hasDateChanges;
    private boolean hasAmountChanges;
    private boolean hasHouseholdChanges;
    private boolean hasFeeTypeChanges;
    private List<PaymentRecord> affectedPayments;
    private List<Household> addedHouseholds;
    private List<Household> removedHouseholds;
    private List<Fee> addedFeeTypes;
    private List<Fee> removedFeeTypes;
    private List<Fee> unchangedFeeTypes;
    private Map<Fee, List<PaymentRecord>> conflictingPayments;
}

// Service xá»­ lÃ½ cáº­p nháº­t
public class CampaignFeeUpdateService {
    public CampaignFeeUpdateAnalysis analyzeCampaignFeeChanges(CampaignFee old, CampaignFee new);
    public List<String> generateWarnings(CampaignFeeUpdateAnalysis analysis);
    public boolean updateCampaignFeeSafely(CampaignFeeUpdateAnalysis analysis);
    
    public boolean validateFeeTypeChanges(CampaignFeeUpdateAnalysis analysis);
    public Map<Fee, List<PaymentRecord>> findConflictingPayments(List<Fee> removedFees);
    public boolean canRemoveFeeTypes(List<Fee> feeTypes);
    public void addFeeTypesToAllHouseholds(List<Fee> newFeeTypes, int campaignId);
    public void removeFeeTypesFromCampaign(List<Fee> feeTypes, int campaignId);
}

// CLASS Má»šI: PhÃ¢n tÃ­ch thay Ä‘á»•i Fee Types
public class FeeTypeChangeAnalyzer {
    public static class FeeTypeChanges {
        private List<Fee> added;
        private List<Fee> removed;
        private List<Fee> unchanged;
        private List<Fee> modified;
    }
    
    public FeeTypeChanges analyzeFeeTypeChanges(List<Fee> oldFees, List<Fee> newFees);
    public boolean hasConflicts(List<Fee> removedFees);
    public Map<Fee, Integer> countPaymentsByFeeType(List<Fee> feeTypes);
}
```

### ğŸ¨ UI Components
```java
// Dialog cáº£nh bÃ¡o Ä‘áº·c biá»‡t
public class CampaignFeeUpdateWarningDialog extends Alert {
    // Hiá»ƒn thá»‹ danh sÃ¡ch cáº£nh bÃ¡o
    // TÃ¹y chá»n hoÃ n tiá»n
    // XÃ¡c nháº­n nhiá»u cáº¥p Ä‘á»™
    // Má»šI: Hiá»ƒn thá»‹ xung Ä‘á»™t khoáº£n thu
    public void showFeeTypeConflicts(Map<Fee, List<PaymentRecord>> conflicts);
    public boolean confirmFeeTypeRemoval(List<Fee> removedFees);
}

// Form cáº­p nháº­t vá»›i validation real-time
public class UpdateCampaignFeeFormHandler {
    // Real-time validation
    // Preview thay Ä‘á»•i
    // Confirmation workflow
    // Má»šI: Fee Type Management
    private FeeTypeSelector feeTypeSelector;
    private FeeTypeConflictPreview conflictPreview;
    
    public void validateFeeTypeChanges();
    public void previewFeeTypeImpact();
    public void handleFeeTypeConflicts();
}

// COMPONENT Má»šI: Quáº£n lÃ½ khoáº£n thu
public class FeeTypeSelector extends VBox {
    private ObservableList<Fee> availableFees;
    private ObservableList<Fee> selectedFees;
    
    public void loadAvailableFees();
    public void updateSelectedFees(List<Fee> fees);
    public List<Fee> getSelectedFees();
    public FeeTypeChanges getChanges();
}

// COMPONENT Má»šI: Preview xung Ä‘á»™t
public class FeeTypeConflictPreview extends VBox {
    public void showConflicts(Map<Fee, List<PaymentRecord>> conflicts);
    public void showImpactSummary(FeeTypeChanges changes);
    public void highlightRiskyChanges();
}
```

---

## ğŸš€ READY FOR IMPLEMENTATION!

Logic cáº­p nháº­t Ä‘á»£t thu phÃ­ Ä‘Ã£ Ä‘Æ°á»£c thiáº¿t káº¿ vá»›i:
- âœ… **PhÃ¢n tÃ­ch thÃ´ng minh** - Detect táº¥t cáº£ loáº¡i thay Ä‘á»•i
- âœ… **Cáº£nh bÃ¡o Ä‘a cáº¥p** - Warning phÃ¹ há»£p vá»›i má»©c Ä‘á»™ rá»§i ro
- âœ… **Xá»­ lÃ½ xung Ä‘á»™t** - Handle cÃ¡c trÆ°á»ng há»£p phá»©c táº¡p
- âœ… **Data Integrity** - Äáº£m báº£o tÃ­nh nháº¥t quÃ¡n dá»¯ liá»‡u
- âœ… **User Experience** - ThÃ´ng bÃ¡o rÃµ rÃ ng, tÃ¹y chá»n linh hoáº¡t

**Sáºµn sÃ ng Ä‘á»ƒ implement logic cáº­p nháº­t Ä‘á»£t thu phÃ­ thÃ´ng minh! ğŸ¯** 